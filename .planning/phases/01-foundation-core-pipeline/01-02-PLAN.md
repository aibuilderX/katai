---
phase: 01-foundation-core-pipeline
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/proxy.ts
  - src/app/(auth)/login/page.tsx
  - src/app/(auth)/register/page.tsx
  - src/app/(auth)/layout.tsx
  - src/app/api/auth/callback/route.ts
  - src/app/(dashboard)/layout.tsx
  - src/app/(dashboard)/page.tsx
  - src/app/(dashboard)/settings/page.tsx
  - src/components/dashboard/sidebar.tsx
  - src/components/dashboard/stats-row.tsx
  - src/components/dashboard/campaign-card.tsx
  - src/stores/ui-store.ts
autonomous: false

must_haves:
  truths:
    - "User can create an account with email/password and see the dashboard"
    - "User can log in with email/password and be redirected to dashboard"
    - "Unauthenticated users are redirected to login page"
    - "Dashboard shows Japanese-only navigation sidebar with 4 nav items"
    - "Dashboard hero area shows big vermillion CTA for campaign creation"
  artifacts:
    - path: "src/proxy.ts"
      provides: "Auth protection for all routes"
      contains: "getUser"
    - path: "src/app/(auth)/login/page.tsx"
      provides: "Login page with email/password + Google SSO"
      min_lines: 40
    - path: "src/app/(dashboard)/layout.tsx"
      provides: "Protected dashboard shell with sidebar"
      min_lines: 30
    - path: "src/components/dashboard/sidebar.tsx"
      provides: "Collapsible sidebar navigation"
      contains: "ダッシュボード"
    - path: "src/app/(dashboard)/page.tsx"
      provides: "Dashboard home with hero CTA and campaigns grid"
      contains: "新しいキャンペーンを作成"
  key_links:
    - from: "src/proxy.ts"
      to: "src/lib/supabase/server.ts"
      via: "Supabase server client for auth check"
      pattern: "createServerClient|getUser"
    - from: "src/app/(auth)/login/page.tsx"
      to: "src/lib/supabase/client.ts"
      via: "Supabase client for signInWithPassword"
      pattern: "signInWithPassword|signInWithOAuth"
    - from: "src/app/(dashboard)/layout.tsx"
      to: "src/components/dashboard/sidebar.tsx"
      via: "Sidebar component import"
      pattern: "import.*Sidebar|sidebar"
---

<objective>
Implement Supabase authentication (email/password + Google SSO) with proxy.ts protection, and build the dashboard shell with Japanese-only sidebar navigation, hero CTA area, and campaign cards grid.

Purpose: Users need to be able to create accounts, log in, and see a functional Japanese-native dashboard. This is the protected shell that all feature pages (brands, campaigns, settings) will live inside.
Output: Working auth flow + dashboard shell with sidebar, hero CTA, stats row, and empty-state campaigns grid.
</objective>

<execution_context>
@/Users/hani/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hani/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-core-pipeline/01-CONTEXT.md
@.planning/phases/01-foundation-core-pipeline/01-RESEARCH.md
@.superdesign/design-system.md
@.planning/phases/01-foundation-core-pipeline/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Supabase Auth with proxy.ts protection</name>
  <files>
    src/proxy.ts
    src/app/(auth)/layout.tsx
    src/app/(auth)/login/page.tsx
    src/app/(auth)/register/page.tsx
    src/app/api/auth/callback/route.ts
  </files>
  <action>
    1. Create `src/proxy.ts` (NOT middleware.ts -- Next.js 16 convention):
       - Create Supabase server client with cookie handlers (getAll/setAll pattern from RESEARCH.md Pattern 1)
       - Call `supabase.auth.getUser()` (NEVER getSession()) to refresh/verify the JWT
       - If no user AND path is NOT /login, /register, /api/webhooks, or static assets: redirect to /login
       - If user exists AND path is /login or /register: redirect to / (dashboard)
       - Export matcher config excluding static files, images, favicon
       - CRITICAL: Do NOT set `export const runtime = 'edge'` -- proxy.ts runs Node.js only in Next.js 16

    2. Create `src/app/(auth)/layout.tsx`:
       - Centered layout for auth pages (login/register)
       - Dark background (#0A0A0A), centered card with subtle border
       - No sidebar, no dashboard shell

    3. Create `src/app/(auth)/login/page.tsx`:
       - Email input + password input + "ログイン" submit button (vermillion primary)
       - "Googleでログイン" button (secondary style with Google icon)
       - Link to register: "アカウントをお持ちでないですか？ 新規登録"
       - On email/password submit: call `supabase.auth.signInWithPassword({ email, password })`
       - On Google button: call `supabase.auth.signInWithOAuth({ provider: 'google', options: { redirectTo: '/api/auth/callback' } })`
       - Show error toast on failure (use sonner or simple inline error)
       - On success: redirect to / (dashboard) via `router.push('/')`
       - This is a client component ('use client')
       - ALL text in Japanese. No English labels.
       - Style per design system: dark card on dark bg, vermillion focus rings on inputs

    4. Create `src/app/(auth)/register/page.tsx`:
       - Email input + password input + password confirm input + "新規登録" submit button
       - "Googleで登録" button
       - Link to login: "すでにアカウントをお持ちですか？ ログイン"
       - On submit: call `supabase.auth.signUp({ email, password })`
       - After signup, create a profile record and a default team:
         Use a database trigger OR handle in a post-signup server action. For Phase 1, insert profile + team after successful signUp via an API call.
       - 'use client' component
       - ALL text in Japanese

    5. Create `src/app/api/auth/callback/route.ts`:
       - Handle OAuth callback from Google SSO
       - Exchange code for session using `supabase.auth.exchangeCodeForSession(code)`
       - Redirect to dashboard on success
       - Follow Next.js 16 async request API pattern (await searchParams)

    IMPORTANT: Use shadcn/ui Button and Input components for consistent styling.
    IMPORTANT: Install shadcn button and input components: `pnpm dlx shadcn@latest add button input`
  </action>
  <verify>
    Run `pnpm build` -- all auth pages compile.
    Verify proxy.ts exports a proxy function (not middleware function).
    Verify no middleware.ts file exists.
    Verify login page contains "ログイン" and register page contains "新規登録" (Japanese only).
    Verify getUser() is used (not getSession()) in proxy.ts.
  </verify>
  <done>
    Auth pages render with Japanese labels. Proxy.ts protects dashboard routes. OAuth callback handler exists. Email/password and Google SSO flows are wired to Supabase Auth.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build dashboard shell with sidebar navigation and hero CTA</name>
  <files>
    src/app/(dashboard)/layout.tsx
    src/app/(dashboard)/page.tsx
    src/app/(dashboard)/settings/page.tsx
    src/components/dashboard/sidebar.tsx
    src/components/dashboard/stats-row.tsx
    src/components/dashboard/campaign-card.tsx
    src/stores/ui-store.ts
  </files>
  <action>
    1. Create `src/stores/ui-store.ts` -- Zustand store for UI state:
       - `sidebarCollapsed: boolean` (default: true -- collapsed to 64px per user decision)
       - `toggleSidebar()` action
       - Simple persistence to localStorage

    2. Create `src/components/dashboard/sidebar.tsx`:
       - Left sidebar: 240px expanded, 64px collapsed (icon-only by default per CONTEXT.md)
       - Background: bg-surface (#1A1A1A), border-right: 1px solid border-subtle
       - Navigation items (each 48px height):
         - ダッシュボード (LayoutDashboard icon)
         - ブランド (Palette icon)
         - キャンペーン (Megaphone icon)
         - 設定 (Settings icon)
       - Active state: vermillion left border accent (3px) + subtle vermillion background (vermillion at 10% opacity)
       - Use next/link for navigation, detect active route via usePathname
       - Collapse/expand toggle button at bottom
       - Logo/brand text at top (app name in Japanese or logo mark)
       - User avatar at bottom (from Supabase auth user metadata)
       - ALL labels in Japanese from next-intl useTranslations
       - Smooth transitions: width 200ms ease-out
       - 'use client' component (uses Zustand store and usePathname)

    3. Create `src/app/(dashboard)/layout.tsx`:
       - Server component that verifies auth (getUser via server Supabase client)
       - If no user, redirect to /login (belt-and-suspenders with proxy.ts)
       - Renders sidebar + main content area
       - Main content: flex-1, overflow-y-auto, padding 32px
       - Fetch user profile for sidebar display

    4. Create `src/components/dashboard/stats-row.tsx`:
       - Row of 3 stat cards (horizontal, below hero):
         - 総キャンペーン数 (total campaigns) -- number display
         - アクティブブランド (active brands) -- number display
         - 今月の生成数 (this month's generations) -- number display
       - Each card: bg-card, subtle border, compact layout
       - Numbers displayed in Display font weight (900)
       - Accept data via props (Phase 1: will show zeros/placeholder until data exists)
       - JetBrains Mono for the numbers

    5. Create `src/components/dashboard/campaign-card.tsx`:
       - Large thumbnail card (16:9 aspect ratio) for past campaigns
       - Thumbnail area with subtle gradient overlay at bottom for text
       - Campaign name (H3, white), date (caption, text-muted), platform count badge (warm-gold pill)
       - Status pill top-right: 生成中 (generating, vermillion-subtle bg), 生成完了 (complete, success), 下書き (draft, bg-hover)
       - Hover: translateY(-8px) + subtle elevation increase, 200ms ease-out transition
       - Border radius: radius-lg (16px)
       - Clicking navigates to /campaigns/[id]
       - Accept campaign data via props (typed with Campaign type)

    6. Create `src/app/(dashboard)/page.tsx`:
       - Dashboard home page (Server Component where possible, client wrapper for interactive parts)
       - Hero area: Large "新しいキャンペーンを作成" vermillion CTA button (links to /campaigns/new)
         - Subtle background treatment, generous padding (space-3xl top/bottom)
       - Stats row below hero (using stats-row component)
       - Past campaigns section: "最近のキャンペーン" heading
         - 3-column grid (lg), 2-col (md), 1-col (mobile) -- gap 24px
         - Campaign cards grid
         - Empty state: centered illustration area + "まだキャンペーンがありません" message + secondary CTA to create first campaign
       - Fetch campaigns from database (will be empty initially, show empty state)
       - First-time user detection: if no brands exist, show onboarding banner: "まずブランドを設定しましょう" with link to /brands/new

    7. Create `src/app/(dashboard)/settings/page.tsx`:
       - Basic settings page with placeholder content
       - Account section: display email, display name (from profile)
       - Logout button: calls `supabase.auth.signOut()` then redirects to /login
       - Team management placeholder (show team name, member list -- basic display only)
       - ALL text in Japanese

    IMPORTANT: Use Lucide React icons throughout (LayoutDashboard, Palette, Megaphone, Settings, Plus, LogOut).
    IMPORTANT: Follow design system spacing, colors, border-radius exactly.
    IMPORTANT: Sidebar collapsed (64px, icon-only) by default per user decision.
    IMPORTANT: Use next-intl useTranslations('nav') for all navigation labels.
  </action>
  <verify>
    Run `pnpm build` -- all dashboard pages and components compile.
    Verify sidebar renders with 4 Japanese navigation items.
    Verify dashboard page contains "新しいキャンペーンを作成" CTA.
    Verify settings page has logout functionality.
    Verify campaign-card has hover animation CSS.
    Manually inspect: `pnpm dev` and visit localhost:3000 -- should redirect to /login.
  </verify>
  <done>
    Dashboard shell renders with collapsed sidebar (4 Japanese nav items with active states). Hero area shows vermillion CTA. Stats row shows 3 metric cards. Campaign grid shows empty state. Settings page has logout. All text is Japanese-only.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete auth flow (login/register with email + Google SSO) and dashboard shell (sidebar navigation, hero CTA, stats row, empty-state campaign grid, settings with logout). All UI is Japanese-only with dark theme matching design system.</what-built>
  <how-to-verify>
    1. Run `pnpm dev` and open http://localhost:3000
    2. You should be redirected to /login
    3. Verify login page shows Japanese labels (ログイン, メールアドレス, パスワード, Googleでログイン)
    4. Click "新規登録" link to go to register page
    5. Create an account with email/password
    6. After registration, verify redirect to dashboard
    7. Verify sidebar shows 4 Japanese nav items (ダッシュボード, ブランド, キャンペーン, 設定) with icons
    8. Verify sidebar is collapsed (64px, icon-only) by default
    9. Verify hero area has large vermillion "新しいキャンペーンを作成" button
    10. Verify empty state message shows (まだキャンペーンがありません)
    11. Verify dark theme colors match design system (#0A0A0A background, #1A1A1A sidebar)
    12. Go to settings, verify logout button works and redirects to /login
  </how-to-verify>
  <resume-signal>Type "approved" or describe any visual/functional issues</resume-signal>
</task>

</tasks>

<verification>
1. `pnpm build` passes with zero errors
2. proxy.ts uses getUser() and protects all dashboard routes
3. Login/register pages are fully Japanese
4. Dashboard sidebar shows 4 nav items with correct active states
5. Hero CTA is vermillion and links to /campaigns/new
6. Empty state is handled gracefully
7. Logout works from settings page
</verification>

<success_criteria>
- User can register with email/password and land on dashboard
- User can log in and see Japanese-only dashboard
- Unauthenticated requests redirect to /login
- Sidebar is collapsible (64px default) with vermillion active states
- Dashboard hero has large CTA, stats row, and campaign grid (empty state)
- Dark theme renders with design system colors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-pipeline/01-02-SUMMARY.md`
</output>

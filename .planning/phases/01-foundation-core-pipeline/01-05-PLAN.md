---
phase: 01-foundation-core-pipeline
plan: 05
type: execute
wave: 4
depends_on: ["01-03", "01-04"]
files_modified:
  - src/app/(dashboard)/campaigns/page.tsx
  - src/app/(dashboard)/campaigns/[id]/page.tsx
  - src/app/api/campaigns/[id]/route.ts
  - src/components/campaign/copy-tab.tsx
  - src/components/campaign/image-tab.tsx
  - src/components/campaign/platform-selector.tsx
  - src/components/campaign/variant-card.tsx
  - src/components/campaign/campaign-sidebar.tsx
  - src/components/campaign/generation-progress.tsx
  - src/hooks/use-campaign-progress.ts
autonomous: false

must_haves:
  truths:
    - "User can see a list of their campaigns with status and thumbnails"
    - "User can view generated copy variants organized by platform with A/B comparison"
    - "User can switch between platform previews with clickable icon pills"
    - "User can view generated base images in a grid"
    - "User can see campaign progress in real-time during generation"
    - "User can copy individual copy variants to clipboard"
  artifacts:
    - path: "src/app/(dashboard)/campaigns/[id]/page.tsx"
      provides: "Campaign results page with tabs"
      min_lines: 40
    - path: "src/components/campaign/copy-tab.tsx"
      provides: "Platform-adaptive copy preview cards"
      contains: "variant"
    - path: "src/components/campaign/variant-card.tsx"
      provides: "Individual A/B variant card with copy-to-clipboard"
      contains: "A案"
    - path: "src/components/campaign/platform-selector.tsx"
      provides: "Clickable platform icon pill row"
      contains: "platform"
    - path: "src/components/campaign/image-tab.tsx"
      provides: "Image grid with download/zoom"
      min_lines: 30
    - path: "src/hooks/use-campaign-progress.ts"
      provides: "Supabase Realtime subscription for campaign progress"
      contains: "postgres_changes"
  key_links:
    - from: "src/app/(dashboard)/campaigns/[id]/page.tsx"
      to: "src/app/api/campaigns/[id]/route.ts"
      via: "Fetch campaign data"
      pattern: "campaigns.*\\[id\\]|api/campaigns"
    - from: "src/hooks/use-campaign-progress.ts"
      to: "src/lib/supabase/client.ts"
      via: "Supabase Realtime subscription"
      pattern: "supabase.*channel|postgres_changes"
    - from: "src/components/campaign/copy-tab.tsx"
      to: "src/components/campaign/variant-card.tsx"
      via: "Renders variant cards in grid"
      pattern: "VariantCard|variant-card"
    - from: "src/components/campaign/copy-tab.tsx"
      to: "src/components/campaign/platform-selector.tsx"
      via: "Platform selection filters displayed variants"
      pattern: "PlatformSelector|platform-selector|selectedPlatform"
---

<objective>
Build the campaign results presentation pages: campaigns list, campaign detail with copy tab (platform-adaptive variant cards), image tab, real-time generation progress, and campaign sidebar with metadata.

Purpose: This is the "payoff moment" -- where users see the AI-generated campaign kit. The platform-adaptive preview cards, A/B variant comparison, and real-time progress feedback are the core product experience that validates the entire pipeline.
Output: Complete campaign viewing experience with list page, detail page (copy + image tabs), platform-adaptive previews, variant actions, and real-time progress.
</objective>

<execution_context>
@/Users/hani/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hani/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation-core-pipeline/01-CONTEXT.md
@.planning/phases/01-foundation-core-pipeline/01-RESEARCH.md
@.superdesign/design-system.md
@.planning/phases/01-foundation-core-pipeline/01-01-SUMMARY.md
@.planning/phases/01-foundation-core-pipeline/01-02-SUMMARY.md
@.planning/phases/01-foundation-core-pipeline/01-03-SUMMARY.md
@.planning/phases/01-foundation-core-pipeline/01-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build campaign list and results page with copy/image tabs</name>
  <files>
    src/app/(dashboard)/campaigns/page.tsx
    src/app/(dashboard)/campaigns/[id]/page.tsx
    src/app/api/campaigns/[id]/route.ts
    src/components/campaign/copy-tab.tsx
    src/components/campaign/image-tab.tsx
    src/components/campaign/platform-selector.tsx
    src/components/campaign/variant-card.tsx
    src/components/campaign/campaign-sidebar.tsx
  </files>
  <action>
    1. Install needed shadcn components: `pnpm dlx shadcn@latest add tabs toast`

    2. Create `src/app/api/campaigns/[id]/route.ts`:
       - GET: Fetch campaign by ID with brand profile, copy variants, and assets
         Use Drizzle joins/relations to get all related data in one query
         Verify team membership for auth
         CRITICAL: `const { id } = await props.params` (Next.js 16 async params)
       - Return: campaign record + brand profile + copy variants grouped by platform + assets

    3. Create `src/app/(dashboard)/campaigns/page.tsx`:
       - Campaigns list page
       - Header: "キャンペーン一覧" with "新しいキャンペーンを作成" button
       - Campaign cards grid (3-col lg, 2-col md, 1-col sm, gap 24px)
       - Reuse campaign-card component from Plan 02 (or import it)
       - Each card: thumbnail, campaign name, date, status pill, platform count badge
       - Sort by newest first
       - Empty state: "まだキャンペーンがありません" with CTA
       - Server Component fetching from DB

    4. Create `src/components/campaign/platform-selector.tsx`:
       - Horizontal row of clickable platform icon pills
       - Show only platforms that were selected in the campaign brief
       - Each pill: platform icon + Japanese name
       - Selected pill: warm-gold underline/border, active background
       - Unselected: bg-surface, text-secondary
       - Click changes the active platform (onChange callback)
       - Scrollable horizontally on mobile
       - 'use client' component

    5. Create `src/components/campaign/variant-card.tsx`:
       - Individual copy variant card for A/B comparison
       - Layout per CONTEXT.md:
         - Warm-gold variant badge top-left (A案, B案, C案, D案)
         - Platform-specific frame/chrome (subtle visual container suggesting the platform)
         - Headline section (見出し label + headline text)
         - Body copy section (本文 label + body text)
         - CTA section (styled button mockup with CTA text)
         - Hashtags as pills (if present)
       - Actions on each card:
         - Copy to clipboard icon (copies all text) -- show toast "コピーしました" on click
         - Favorite/star icon (toggles isFavorite, sends PATCH to API)
       - Card styling: bg-card, border-subtle, radius-lg, generous padding
       - View toggle support: Accept a 'view' prop ('preview' | 'text')
         - Preview mode: shows platform-adaptive visual mockup
         - Text mode: shows raw text in clean layout (simpler, text-focused)

    6. Create `src/components/campaign/copy-tab.tsx`:
       - Platform selector row at top
       - View toggle: プレビュー表示 / テキスト表示 (two buttons/pills)
       - 2x2 grid of variant cards for selected platform
       - Filters copyVariants by selected platform
       - If no variants exist for selected platform: show "このプラットフォームのコピーはまだありません"
       - 'use client' component (interactive platform selection + view toggle)

    7. Create `src/components/campaign/image-tab.tsx`:
       - 2x2 grid of generated images
       - Each image: 16:9 container with object-cover
       - Hover overlay: download icon + zoom icon (both as icon buttons)
       - Download: trigger browser download via anchor tag with download attribute
       - Zoom: Open image in full-screen modal/lightbox (use Dialog component)
       - Subtle card border, radius-lg
       - If no images: "画像はまだありません"

    8. Create `src/components/campaign/campaign-sidebar.tsx`:
       - Right sidebar (280-320px) on the campaign results page
       - Campaign brief summary:
         - ブランド名 with brand name
         - ターゲット with target audience text
         - プラットフォーム with platform icons (small, inline)
         - トーン with tone tags as small badges
         - 敬語レベル with register name
       - Generation metadata:
         - 生成時間 with duration
         - 使用モデル with Claude + Flux badges (JetBrains Mono, small)
         - バリエーション数 with count
       - Re-edit action: "ブリーフを編集して再生成" button (links to /campaigns/new pre-filled, or future re-generation)
       - Sticky positioning (fixed on scroll)

    9. Create `src/app/(dashboard)/campaigns/[id]/page.tsx`:
       - Campaign results page
       - Breadcrumb: キャンペーン一覧 > [キャンペーン名]
       - Campaign header: campaign name, brand name, date, status badge (生成完了/生成中)
       - Action buttons in header: "ダウンロード" (vermillion primary), "再生成" (secondary)
       - Tabs: コピー (copy, default) and 画像 (images) with warm-gold active underline
       - Tab content: CopyTab or ImageTab component
       - Right sidebar: CampaignSidebar component
       - Layout: main content (flex-1) + sidebar (280-320px) on desktop, stacked on mobile
       - If campaign status is 'generating': show progress component instead of results
       - If campaign status is 'failed': show error message with "再試行" (retry) button
       - CRITICAL: `const { id } = await props.params` (Next.js 16)

    CRITICAL: All text Japanese-only. Zero English in user-facing elements.
    CRITICAL: Use warm-gold for variant labels (A案〜D案) per CONTEXT.md.
    CRITICAL: Platform-adaptive preview is the key differentiator -- make the cards visually distinct per platform.
    CRITICAL: Copy-to-clipboard must work and show Japanese toast.
  </action>
  <verify>
    Run `pnpm build` -- all campaign components and pages compile.
    Verify variant-card.tsx contains "A案" and copy-to-clipboard functionality.
    Verify platform-selector.tsx renders platform icons.
    Verify campaigns/[id]/page.tsx has コピー and 画像 tabs.
    Verify campaign-sidebar.tsx shows all metadata fields in Japanese.
    Verify campaigns/page.tsx has "キャンペーン一覧" heading.
  </verify>
  <done>
    Campaign list page shows all campaigns with status. Campaign detail page has copy and image tabs. Copy tab shows platform-adaptive variant cards in 2x2 grid with A/B labels. Image tab shows generated images with download/zoom. Campaign sidebar displays brief summary and generation metadata. All text is Japanese-only.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add real-time generation progress and campaigns list integration</name>
  <files>
    src/hooks/use-campaign-progress.ts
    src/components/campaign/generation-progress.tsx
  </files>
  <action>
    1. Create `src/hooks/use-campaign-progress.ts`:
       - Custom hook `useCampaignProgress(campaignId: string)` following RESEARCH.md Pattern 5
       - Subscribe to Supabase Realtime postgres_changes on campaigns table
       - Filter by campaign ID
       - Listen for UPDATE events on progress and status fields
       - Return: { progress, status, isGenerating, isComplete, isFailed }
       - Cleanup: remove channel on unmount
       - 'use client' hook (uses useEffect, useState)
       - Also use TanStack Query for initial data fetch with refetch on focus

    2. Create `src/components/campaign/generation-progress.tsx`:
       - Shown on campaign detail page when status is 'generating'
       - Visual progress display:
         - Overall progress bar (vermillion fill on dark track)
         - Step indicators:
           - コピー生成中... (copy generating) -- with spinner or checkmark
           - 画像生成中... (image generating) -- with spinner or checkmark
         - Percentage text (JetBrains Mono font)
       - Animate progress bar smoothly (CSS transition)
       - When complete (status changes to 'complete'):
         - Show "生成完了！" success message briefly
         - Auto-transition to showing the results (copy/image tabs)
       - When failed:
         - Show error icon + "生成に失敗しました" message
         - Show error details if available
         - "再試行" (retry) button
       - Uses useCampaignProgress hook
       - 'use client' component

    3. Update the campaign detail page integration:
       - If status is 'generating', render GenerationProgress component
       - When useCampaignProgress reports 'complete', refetch campaign data and show results
       - This creates the real-time experience: user submits brief -> sees progress -> results appear

    IMPORTANT: Supabase Realtime requires the table to have REPLICA IDENTITY set.
    Add a note in the component about this database requirement.
  </action>
  <verify>
    Run `pnpm build` -- progress components compile.
    Verify use-campaign-progress.ts subscribes to postgres_changes.
    Verify generation-progress.tsx shows Japanese step labels (コピー生成中, 画像生成中).
    Verify progress bar uses vermillion color.
  </verify>
  <done>
    Real-time progress hook subscribes to Supabase Realtime for campaign updates. Progress UI shows step-by-step generation status with animated progress bar. Auto-transitions to results on completion. Error state handled with retry option.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete campaign experience: campaigns list page, campaign results page with copy tab (platform-adaptive A/B variant cards), image tab (grid with download/zoom), real-time generation progress, campaign sidebar with metadata. All text is Japanese-only with dark theme. This represents the full Phase 1 product loop: login -> brand setup -> brief submission -> AI generation -> results viewing.</what-built>
  <how-to-verify>
    1. Run `pnpm dev` and log in
    2. If no brand exists, go to /brands/new and create a brand through the wizard
    3. Click "新しいキャンペーンを作成" on the dashboard
    4. Fill out the brief form: select brand, objective, audience, platforms, creative direction
    5. Submit the brief -- you should see the generation progress UI
    6. Once generation completes (or if using direct fallback), verify:
       a. Copy tab shows variant cards with A案〜D案 labels
       b. Platform selector switches between platforms
       c. Copy-to-clipboard works on variant cards
       d. Image tab shows generated images with hover actions
    7. Verify campaign sidebar shows brief summary and metadata
    8. Go to /campaigns -- verify list shows the campaign with correct status
    9. Go back to dashboard -- verify the campaign card appears in the grid
    10. Verify ALL text is Japanese throughout the entire flow
    11. Verify dark theme colors are consistent with design system
  </how-to-verify>
  <resume-signal>Type "approved" or describe any visual/functional issues</resume-signal>
</task>

</tasks>

<verification>
1. `pnpm build` passes
2. Campaigns list page renders with correct Japanese headings
3. Campaign detail page has copy and image tabs
4. Copy tab renders platform-adaptive variant cards with A/B labels
5. Platform selector filters variants by platform
6. Image tab shows grid with download/zoom hover actions
7. Real-time progress shows during generation
8. Campaign sidebar displays all metadata in Japanese
9. Full product loop works: brief -> generation -> results
</verification>

<success_criteria>
- User can see all campaigns in a list with status and thumbnails
- Campaign results page shows copy variants per platform with A/B comparison
- Platform selector switches between platform preview formats
- Copy-to-clipboard works on variant cards
- Image tab shows generated base images with download
- Real-time progress updates during generation
- Campaign sidebar shows brief summary and generation metadata
- Full Phase 1 loop is functional: auth -> brand -> brief -> generate -> view results
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-pipeline/01-05-SUMMARY.md`
</output>

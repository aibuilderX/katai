---
phase: 09.1-agent-prompt-engineering-photorealistic-output
plan: 02
subsystem: ai, prompts
tags: [strategic-insight, creative-director, prompt-engineering, tool-use, xml-tags, schwartz, lf8, aidma, aisas, japanese-advertising]

# Dependency graph
requires:
  - phase: 09.1-agent-prompt-engineering-photorealistic-output
    plan: 01
    provides: "Schwartz awareness levels, LF8 desires, Japanese desire nuances, 5 copywriting frameworks, agent config, AgentPromptBuilder interface, pipeline types"
provides:
  - "Strategic Insight system prompt builder with embedded Schwartz/LF8/AIDMA/AISAS knowledge"
  - "Strategic Insight tool schema enforcing output completeness (ORCH-09 quality gate)"
  - "Creative Director system prompt builder with Japanese creative conventions"
  - "Creative Director mode-dependent tool schemas (auto: 1 concept, pro: 2-3 concepts)"
  - "User message builders for both agents accepting brief + brand profile"
affects: [09.1-03, 09.1-04, 09.1-05]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "XML-tagged system prompts with <role>, <knowledge>, <task>, <constraints>, <output_format>, <examples> sections"
    - "Tool-use forced output with tool_choice pattern for schema-compliant structured output"
    - "Few-shot examples embedded in system prompt as JSON matching exact tool schema"
    - "Mode-dependent tool schema variants with selector function (auto vs pro)"
    - "Shared CONCEPT_PROPERTIES definition reused across auto/pro schemas"

key-files:
  created:
    - "src/lib/ai/prompts/agents/strategic-insight.ts"
    - "src/lib/ai/prompts/agents/creative-director.ts"
  modified: []

key-decisions:
  - "Strategic Insight uses 1 few-shot example (cosmetics brief for 30s women) per research recommendation for analytical agents"
  - "Creative Director uses 2 few-shot examples (cosmetics + food) showing range per research recommendation for creative agents"
  - "Creative Director Pro mode wraps concepts in array with minItems:2/maxItems:3; Auto mode uses flat single-concept object"
  - "Both prompts use English system prompts with Japanese output fields (summaryJa) per research recommendation"

patterns-established:
  - "Agent prompt builder pattern: buildSystemPrompt() + buildUserMessage(params) + TOOL_SCHEMA export"
  - "XML-tagged knowledge sections embedding imported shared data module content inline"
  - "Confidence scores in tool schema as enum ['high', 'medium', 'low']"
  - "Mode-dependent schema selection via getToolSchema(mode) function"

requirements-completed: [ORCH-04, ORCH-05, ORCH-09]

# Metrics
duration: 5min
completed: 2026-02-19
---

# Phase 9.1 Plan 02: Strategic Insight and Creative Director Prompt Builders Summary

**Strategic Insight prompt builder with Schwartz/LF8/AISAS framework classification and ORCH-09 quality gate schema, plus Creative Director prompt builder with Japanese creative conventions and mode-dependent concept output (auto: 1, pro: 2-3)**

## Performance

- **Duration:** 5 min
- **Started:** 2026-02-19T08:01:48Z
- **Completed:** 2026-02-19T08:06:15Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments
- Created Strategic Insight prompt builder with XML-tagged system prompt embedding all 5 Schwartz awareness levels, 8 LF8 desires, 3 Japanese cultural nuances, and 5 copywriting frameworks (PAS/AIDA/BAB/AIDMA/AISAS) with selection criteria
- Created Creative Director prompt builder with 5 Japanese creative conventions (indirectness, seasonal sensitivity, kawaii, wa/harmony, trust signals) and upstream context awareness mapping
- Implemented mode-dependent tool schemas for Creative Director (auto: single concept, pro: 2-3 concept array) with shared property definitions and selector function
- Both agents use tool-use forced output for schema compliance, acting as quality gates (ORCH-09 for Strategic Insight)

## Task Commits

Each task was committed atomically:

1. **Task 1: Create Strategic Insight agent prompt builder with quality gate schema** - `8194e85` (feat)
2. **Task 2: Create Creative Director agent prompt builder with mode-dependent output** - `004908d` (feat)

## Files Created/Modified
- `src/lib/ai/prompts/agents/strategic-insight.ts` - System prompt builder (Schwartz/LF8/frameworks knowledge), user message builder (brief + brand profile), tool schema (ORCH-09 quality gate with confidence scores)
- `src/lib/ai/prompts/agents/creative-director.ts` - System prompt builder (Japanese creative conventions + upstream context awareness), user message builder (strategicInsight + brief + brand + mode), auto/pro tool schemas with selector

## Decisions Made
- **1 few-shot for Strategic Insight, 2 for Creative Director:** Follows research section 2.3 recommendation -- analytical agents need 1 complete format demonstration, creative agents benefit from 2 diverse examples showing range (cosmetics: elegant/warm vs. food: vibrant/appetizing)
- **Pro mode wraps concepts in array, auto mode uses flat object:** This keeps the auto-mode response clean and direct while pro mode naturally extends to 2-3 concepts. The selector function `getCreativeDirectorToolSchema(mode)` abstracts this from callers.
- **Shared CONCEPT_PROPERTIES constant for auto/pro schemas:** Prevents drift between the two schema variants -- same property definitions, different wrapping structure.
- **Creative Director references StrategicInsightOutput field names in user message:** Uses `lf8Desires` (not `primaryDesires`) matching the actual interface field name from pipeline.ts for correct downstream data flow.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Both prompt builders are importable and type-safe -- Plan 03 (Copywriter) and Plan 04 (Art Director) can build on the established pattern
- The AgentPromptBuilder interface pattern (buildSystemPrompt + buildUserMessage + getToolSchema) is now demonstrated in two concrete implementations
- Strategic Insight tool schema provides the output contract that Creative Director user message builder consumes, validating the inter-agent data flow
- Creative Director output feeds into both Copywriter (copy direction, tonal guidance) and Art Director (visual concept, color guidance, composition notes)

## Self-Check: PASSED

All 2 files verified present. Both task commits (8194e85, 004908d) verified in git log.

---
*Phase: 09.1-agent-prompt-engineering-photorealistic-output*
*Completed: 2026-02-19*

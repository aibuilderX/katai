---
phase: 09.1-agent-prompt-engineering-photorealistic-output
plan: 04
subsystem: ai, prompts
tags: [flux, photorealism, meta-prompt, art-director, camera-lens, self-critique, japanese-advertising]

# Dependency graph
requires:
  - phase: 09.1-agent-prompt-engineering-photorealistic-output
    plan: 01
    provides: "CAMERA_LENS_DATABASE, PHOTOREALISM_KEYWORDS, SKIN_REALISM_COUNTERS, FLUX_CONFIG, ART_DIRECTOR_QUALITY_CHECKLIST, AgentPromptBuilder interface, ArtDirectorOutput type"
provides:
  - "buildArtDirectorSystemPrompt() meta-prompt with photography knowledge, Flux constraints, 6 category templates, self-critique checklist, anti-patterns, and 3 few-shot examples"
  - "buildArtDirectorUserMessage() with GENX-09 brand-profile-less inference support"
  - "ART_DIRECTOR_TOOL_SCHEMA_AUTO (1 prompt per platform) and ART_DIRECTOR_TOOL_SCHEMA_PRO (2-3 variations per platform)"
  - "getArtDirectorToolSchema(mode) helper for mode-dependent schema selection"
affects: [09.1-05]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Meta-prompt system: teaches Claude HOW to craft Flux prompts via embedded photography knowledge and quality checklist, not fixed templates"
    - "Category-aware camera/lens selection: Art Director infers product category from brief and selects equipment from CAMERA_LENS_DATABASE"
    - "Chain-of-thought self-critique grounded by 8-item quality checklist (avoids mirror loop)"
    - "Mode-dependent tool schemas: auto delivers flat imagePrompts array, pro wraps in variations array with variationTheme labels"

key-files:
  created:
    - "src/lib/ai/prompts/agents/art-director.ts"
  modified: []

key-decisions:
  - "3 few-shot examples (cosmetics, food, fashion) demonstrating complete tool output with self-critique notes"
  - "Self-critique as chain-of-thought within single call, grounded by concrete checklist (not separate evaluation call)"
  - "Pro mode tool schema uses variations wrapper with variationTheme labels rather than flat array"

patterns-established:
  - "Meta-prompt builder: XML-tagged sections built from shared data modules via buildPromptFromSections"
  - "Few-shot examples show complete tool-use output including metadata fields (productCategory, cameraLens, lightingSetup, compositionGuidance)"
  - "GENX-09 inference: explicit user message instruction when brand profile colors/tone are missing"

requirements-completed: [ORCH-07, GENX-09]

# Metrics
duration: 4min
completed: 2026-02-19
---

# Phase 9.1 Plan 04: Art Director Meta-Prompt Summary

**Meta-prompt system with category-aware camera/lens selection, 8-item self-critique checklist, skin realism counters, 6 category templates, Japanese demographic defaults, and mode-dependent tool schemas for Flux 1.1 Pro Ultra photorealistic image prompt generation**

## Performance

- **Duration:** 4 min
- **Started:** 2026-02-19T08:01:28Z
- **Completed:** 2026-02-19T08:05:16Z
- **Tasks:** 1
- **Files modified:** 1

## Accomplishments
- Created the Art Director meta-prompt builder that teaches Claude HOW to craft case-specific Flux prompts using embedded photography knowledge, category-aware camera/lens selection, and mandatory quality self-critique
- Embedded all 5 shared data modules (CAMERA_LENS_DATABASE, PHOTOREALISM_KEYWORDS, SKIN_REALISM_COUNTERS, FLUX_CONFIG, ART_DIRECTOR_QUALITY_CHECKLIST) into XML-tagged system prompt sections
- Built 3 diverse few-shot examples (cosmetics/people-focused, food/product-focused, fashion/lifestyle) demonstrating complete tool output with self-critique process notes
- Implemented GENX-09: user message explicitly instructs palette/tone inference when brand profile is missing

## Task Commits

Each task was committed atomically:

1. **Task 1: Create Art Director meta-prompt builder with self-critique and category-aware prompting** - `be8958a` (feat)

## Files Created/Modified
- `src/lib/ai/prompts/agents/art-director.ts` - Meta-prompt system builder (buildArtDirectorSystemPrompt), user message builder (buildArtDirectorUserMessage), auto/pro tool schemas (ART_DIRECTOR_TOOL_SCHEMA_AUTO, ART_DIRECTOR_TOOL_SCHEMA_PRO), and mode selector (getArtDirectorToolSchema)

## Decisions Made
- **3 few-shot examples selected:** Cosmetics (people-focused with skin realism), food (product-focused with macro detail), and fashion (lifestyle/editorial). These cover the three most common Japanese small business categories and demonstrate different prompt approaches (close-up beauty, food macro, environmental portrait).
- **Self-critique as chain-of-thought in single call:** Research confirms chain-of-thought self-critique grounded by a concrete checklist avoids the "mirror loop" problem while saving an API call vs. separate evaluation.
- **Pro mode variation wrapper:** Pro schema uses a `variations` array with `variationTheme` labels (e.g., "warm and intimate", "bold and energetic") wrapping per-platform prompt sets, rather than a flat array, to clearly group related visual approaches.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Art Director meta-prompt is ready for integration into the n8n agent pipeline
- The module imports from Plan 01's shared data modules (flux-techniques.ts, quality-checklist.ts) and agents/types.ts
- Plan 05 (evaluation/A/B comparison) can now test the Art Director prompt against the naive prompts in image-generation.ts
- All 5 exports match the plan specification: buildArtDirectorSystemPrompt, buildArtDirectorUserMessage, ART_DIRECTOR_TOOL_SCHEMA_AUTO, ART_DIRECTOR_TOOL_SCHEMA_PRO, getArtDirectorToolSchema

## Self-Check: PASSED

All 1 file verified present. Task commit (be8958a) verified in git log.

---
*Phase: 09.1-agent-prompt-engineering-photorealistic-output*
*Completed: 2026-02-19*

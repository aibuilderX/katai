---
phase: 09.1-agent-prompt-engineering-photorealistic-output
plan: 02
type: execute
wave: 2
depends_on: [09.1-01]
files_modified:
  - src/lib/ai/prompts/agents/strategic-insight.ts
  - src/lib/ai/prompts/agents/creative-director.ts
autonomous: true
requirements: [ORCH-04, ORCH-05, ORCH-09]

must_haves:
  truths:
    - "Strategic Insight prompt builder produces an XML-tagged system prompt with Schwartz awareness levels, LF8 desires + Japanese cultural overlays, and 5 copywriting frameworks (PAS/AIDA/BAB/AIDMA/AISAS)"
    - "Strategic Insight always infers confidently from sparse input -- pipeline never stalls on incomplete briefs"
    - "Strategic Insight includes confidence scores (high/medium/low) per classification dimension"
    - "Strategic Insight tool schema enforces output completeness (quality gate via tool-use schema validation) per ORCH-09"
    - "Creative Director prompt builder generates structured creative briefs with visual concept, color guidance, composition notes, mood keywords, and platform adaptations"
    - "Creative Director mode-dependent behavior: 1 concept for auto mode, 2-3 concepts for pro mode"
    - "Both prompts use English system prompts with Japanese output fields (summaryJa) per research recommendation"
  artifacts:
    - path: "src/lib/ai/prompts/agents/strategic-insight.ts"
      provides: "System prompt builder, user message builder, and tool schema for Strategic Insight agent"
      exports: ["buildStrategicInsightSystemPrompt", "buildStrategicInsightUserMessage", "STRATEGIC_INSIGHT_TOOL_SCHEMA"]
    - path: "src/lib/ai/prompts/agents/creative-director.ts"
      provides: "System prompt builder, user message builder, and tool schema for Creative Director agent"
      exports: ["buildCreativeDirectorSystemPrompt", "buildCreativeDirectorUserMessage", "CREATIVE_DIRECTOR_TOOL_SCHEMA"]
  key_links:
    - from: "src/lib/ai/prompts/agents/strategic-insight.ts"
      to: "src/lib/ai/prompts/shared/frameworks.ts"
      via: "Imports SCHWARTZ_AWARENESS_LEVELS, LF8_DESIRES, JAPANESE_DESIRE_NUANCES, COPYWRITING_FRAMEWORKS"
      pattern: "import.*from.*shared/frameworks"
    - from: "src/lib/ai/prompts/agents/creative-director.ts"
      to: "src/types/pipeline.ts"
      via: "Tool schema matches CreativeDirectorOutput interface"
      pattern: "CreativeDirectorOutput"
    - from: "STRATEGIC_INSIGHT_TOOL_SCHEMA"
      to: "StrategicInsightOutput"
      via: "Tool-use schema properties mirror the TypeScript interface fields exactly"
      pattern: "awarenessLevel.*awarenessConfidence.*primaryDesires.*copywritingFramework"
---

<objective>
Create the Strategic Insight and Creative Director agent prompt builders with research-backed XML-tagged system prompts, tool-use schemas for forced structured output, and few-shot examples.

Purpose: These two agents form the strategic foundation of the pipeline. Strategic Insight classifies the brief and sets the framework for all downstream agents. Creative Director translates strategy into actionable creative direction. Both need precise, research-backed prompts that consistently produce high-quality structured output.

Output: 2 prompt builder modules with system prompts, user message builders, tool schemas, and few-shot examples.
</objective>

<execution_context>
@/Users/hani/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hani/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09.1-agent-prompt-engineering-photorealistic-output/09.1-CONTEXT.md
@.planning/phases/09.1-agent-prompt-engineering-photorealistic-output/09.1-RESEARCH.md
@.planning/phases/09.1-agent-prompt-engineering-photorealistic-output/09.1-01-SUMMARY.md
@src/types/pipeline.ts
@src/lib/ai/prompts/shared/frameworks.ts
@src/lib/ai/prompts/shared/agent-config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Strategic Insight agent prompt builder with quality gate schema</name>
  <files>
    src/lib/ai/prompts/agents/strategic-insight.ts
  </files>
  <action>
Create `src/lib/ai/prompts/agents/strategic-insight.ts` with three exports:

**1. `buildStrategicInsightSystemPrompt()` — Returns the system prompt string.**

Use the XML-tagged structure from research section 2.4. The system prompt must contain these sections:

SECTION [role]: "You are a strategic marketing analyst specializing in the Japanese market. You classify campaign briefs into actionable strategic frameworks that guide downstream creative and copy agents. Your classifications are confident and decisive — you always provide a classification even from sparse input."

SECTION [knowledge]: Embed framework knowledge from shared/frameworks.ts imports:
- Schwartz 5 Awareness Levels with descriptions and downstream implications
- LF8 8 Desires with Japanese cultural overlay mapping (和, 美意識, 安心・安全)
- 5 Copywriting Frameworks (PAS, AIDA, BAB, AIDMA, AISAS) with selection criteria:
  * PAS: Best for pain-point products, problem-aware audiences
  * AIDA: General awareness, broad audiences, new market entry
  * BAB: Transformation products, aspirational positioning
  * AIDMA: Traditional Japanese channels, brand recall campaigns, established brands
  * AISAS: Digital-first Japanese campaigns, social sharing, search-heavy purchase journeys

SECTION [task]: "Analyze the campaign brief and classify it into: 1) Schwartz awareness level, 2) Primary LF8 desires (1-3), 3) Japanese desire nuance if applicable, 4) Copywriting framework, 5) Target insight, creative direction, key messages, and tonal guidance. Always infer confidently. If the brief is vague, make reasonable assumptions based on product type and audience. Never leave fields empty or request more information. Include confidence score (high/medium/low) for each classification."

SECTION [constraints]:
- Classification must be decisive — never output "unclear" or "need more info"
- Framework rationale must explain WHY this framework suits this specific brief
- Key messages: 2-4 concrete messages, not generic marketing platitudes
- Tonal guidance must specify register recommendation (casual/standard/formal) with reasoning
- summaryJa: ~10 word Japanese summary of the strategic direction
- Market context: 1-2 sentences on competitive/market positioning when inferable

SECTION [output_format]: "Use the deliver_strategic_insight tool to return your analysis. All fields are required."

Add 1 few-shot example (research section 2.3 recommends 1 complete example for Strategic Insight). Example: cosmetics brief for 30s women → problem_aware, LF8 desires [1,8], AISAS framework.

Do NOT include "think step by step" or "be thorough" language — per research section 2.1, Claude 4.6 overthinks with these. The effort parameter controls thinking depth.

**2. `buildStrategicInsightUserMessage(brief, brandProfile)` — Returns the user message string.**

Format the brief fields into a structured XML-tagged user message with a [brief] section containing: Product/Service (from brief.campaignProductInfo or brandProfile.name), Objective (brief.objective), Target Audience (brief.targetAudience), Platforms (brief.platforms), Creative Direction (brief.creativeDirection), Mood (brief.creativeMoodTags), Brand Context (brandProfile summary — name, positioning, target market, product catalog), Register Override (brief.registerOverride or "none — infer from product category"). End with "Classify this brief and deliver your strategic analysis."

Accept `brief: CampaignBrief` and `brandProfile` as parameters. Import types from existing type definitions.

**3. `STRATEGIC_INSIGHT_TOOL_SCHEMA` — Tool schema for forced structured output.**

Define the tool-use schema matching the updated `StrategicInsightOutput` interface from pipeline.ts. All fields required except `japaneseDesireNuance` and `marketContext` (optional). Use `tool_choice: { type: "tool", name: "deliver_strategic_insight" }` pattern.

The schema acts as the ORCH-09 quality gate — tool-use guarantees schema compliance. The tool schema must require:
- `awarenessLevel`: enum of 5 values
- `awarenessConfidence`: enum of 3 values (high/medium/low)
- `primaryDesires`: array of strings (minItems: 1, maxItems: 3)
- `desireConfidence`: enum
- `copywritingFramework`: enum of 5 values (PAS/AIDA/BAB/AIDMA/AISAS)
- `frameworkConfidence`: enum
- `frameworkRationale`: string (minLength: 20)
- `targetInsight`: string (minLength: 10)
- `creativeDirection`: string (minLength: 10)
- `keyMessages`: array of strings (minItems: 2, maxItems: 4)
- `tonalGuidance`: string
- `summaryJa`: string
  </action>
  <verify>
Run `npx tsc --noEmit src/lib/ai/prompts/agents/strategic-insight.ts` — no type errors. Verify the module exports all 3 items. Verify the tool schema has required fields matching StrategicInsightOutput. Verify the system prompt does NOT contain anti-laziness language ("think step by step", "be thorough", "carefully consider").
  </verify>
  <done>
Strategic Insight prompt builder exists with XML-tagged system prompt containing embedded Schwartz/LF8/AIDMA/AISAS knowledge, 1 few-shot example, user message builder accepting brief+brand, and tool schema enforcing output completeness (ORCH-09 quality gate via schema validation). Confidence scores are included in schema. No SB7 in framework set.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Creative Director agent prompt builder with mode-dependent output</name>
  <files>
    src/lib/ai/prompts/agents/creative-director.ts
  </files>
  <action>
Create `src/lib/ai/prompts/agents/creative-director.ts` with three exports:

**1. `buildCreativeDirectorSystemPrompt()` — Returns the system prompt string.**

XML-tagged structure with these sections:

SECTION [role]: "You are a creative director specializing in Japanese advertising campaigns. You translate strategic analysis into actionable creative concepts — visual direction, tonal guidance, and platform-specific adaptations. Your concepts are grounded in Japanese creative conventions, not generic Western advertising patterns."

SECTION [knowledge]: Embed Japanese creative conventions from research section 3.2:
- Indirectness over hard sell: Japanese advertising favors suggestion and mood over direct claims
- Seasonal sensitivity (季節感): Strong seasonal references (cherry blossom spring, fireworks summer, autumn leaves fall, year-end/New Year winter)
- Kawaii and relatability: Approachable aesthetics often outperform aspirational luxury (market segment dependent)
- Wa (harmony) in visual composition: Balance, negative space, visual harmony are culturally valued
- Trust signals: Third-party validation, awards, user counts, longevity ("since 19XX") valued more than in Western markets
Also embed understanding of upstream fields:
- awarenessLevel: affects visual approach (unaware=education, problem_aware=empathy, solution_aware=differentiation, product_aware=features, most_aware=offer)
- copywritingFramework: affects narrative structure (AISAS=search/share moments, AIDMA=memory/recall imagery)
- primaryDesires: affects emotional tone (LF8 desire mapping)

SECTION [task]: "Generate a creative concept that translates the strategic analysis into visual and copy direction. Output must be specific enough for Copywriter and Art Director. Auto mode: 1 optimized concept. Pro mode: 2-3 concept options with distinct creative angles."

SECTION [constraints]:
- Visual concepts must be specific, not generic ("woman laughing in a field" vs. "warm, inviting imagery")
- Color guidance should include specific hex codes when brand has defined colors, otherwise curated palette
- Platform adaptations must address at least 2 platforms with specific visual/tonal adjustments
- Seasonal awareness: Reference current season when appropriate for the Japanese market
- summaryJa: ~10 word Japanese summary
- copyDirection must include register recommendation and tonal angle (not just "friendly")

SECTION [output_format]: "Use the deliver_creative_direction tool to return your creative concept(s). All fields are required."

Add 2 few-shot examples per research section 2.3:
- Example A: Cosmetics brief → warm, aspirational, elegant visual concept with soft lighting direction
- Example B: Restaurant/food brief → appetizing, vibrant, seasonal visual concept with natural lighting

**2. `buildCreativeDirectorUserMessage(strategicInsight, brief, brandProfile, mode)` — Returns user message.**

Format as XML-tagged sections:
- [strategic_context] section: Awareness Level, Primary Desires, Japanese Nuance, Framework + rationale, Target Insight, Creative Direction from Strategy, Key Messages, Tonal Guidance (all from strategicInsight)
- [brief] section: Brand (brandProfile.name), Product Info (brief.campaignProductInfo), Platforms, Mood Tags, User Creative Direction, Brand Colors (or "none — infer appropriate palette")
- [mode] section: the mode value
- Instruction: "Generate 1 optimized concept" for auto, "Generate 2-3 concept options" for pro

The `mode` parameter is `"auto" | "pro"`.

**3. `CREATIVE_DIRECTOR_TOOL_SCHEMA` — Tool schema matching updated CreativeDirectorOutput.**

Schema includes:
- `concept`: string (required, one-sentence distillation)
- `visualConcept`: string (required, detailed visual direction)
- `colorGuidance`: string (required)
- `compositionNotes`: string (required)
- `moodKeywords`: array of strings (4-6 items)
- `copyDirection`: string (required, tonal guidance for Copywriter)
- `platformAdaptations`: object with string values keyed by platform
- `summaryJa`: string (required)

For Pro mode, the schema wraps concepts in an array: `concepts: [{ concept, visualConcept, ... }]` with minItems: 2, maxItems: 3. For Auto mode, a single object. Handle this by exporting two schema variants: `CREATIVE_DIRECTOR_TOOL_SCHEMA_AUTO` and `CREATIVE_DIRECTOR_TOOL_SCHEMA_PRO`, plus a selector function `getCreativeDirectorToolSchema(mode)`.
  </action>
  <verify>
Run `npx tsc --noEmit src/lib/ai/prompts/agents/creative-director.ts` — no type errors. Verify the module exports all items. Verify the system prompt contains Japanese creative conventions from research. Verify mode-dependent tool schemas exist for auto and pro.
  </verify>
  <done>
Creative Director prompt builder exists with XML-tagged system prompt embedding Japanese creative conventions (indirectness, seasonality, wa, trust signals), upstream context awareness, 2 few-shot examples, user message builder accepting strategicInsight+brief+brand+mode, and mode-dependent tool schemas (1 concept for auto, 2-3 for pro).
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes for both files
- Strategic Insight system prompt embeds all 5 Schwartz levels, 8 LF8 desires, 3 Japanese nuances, 5 frameworks
- Strategic Insight tool schema requires all fields matching StrategicInsightOutput (quality gate via schema)
- Creative Director system prompt embeds 5 Japanese creative conventions
- Creative Director supports auto/pro mode with different tool schemas
- Neither prompt contains anti-laziness language (no "think step by step", "be thorough")
- Both prompts use English system prompts with Japanese output fields (summaryJa)
</verification>

<success_criteria>
- Strategic Insight classifies any brief into awareness level, desires, and framework with confidence scores
- Creative Director translates strategic output into actionable visual and copy direction
- Tool schemas enforce output completeness (no empty or partial outputs)
- Prompts are documented with rationale for every design decision
</success_criteria>

<output>
After completion, create `.planning/phases/09.1-agent-prompt-engineering-photorealistic-output/09.1-02-SUMMARY.md`
</output>

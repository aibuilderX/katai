---
phase: 09.1-agent-prompt-engineering-photorealistic-output
plan: 04
type: execute
wave: 2
depends_on: [09.1-01]
files_modified:
  - src/lib/ai/prompts/agents/art-director.ts
autonomous: true
requirements: [ORCH-07, GENX-09]

must_haves:
  truths:
    - "Art Director meta-prompt teaches Claude HOW to craft Flux prompts, not WHAT specific prompts to write — case-by-case generation, not fixed templates"
    - "Art Director infers product category from brief content and selects camera/lens/lighting from the category database"
    - "Art Director generates quality image prompts without a brand profile by inferring visual defaults from brief content (GENX-09)"
    - "Self-critique loop is mandatory: Art Director reviews generated prompts against an 8-item quality checklist via chain-of-thought before finalizing"
    - "All prompts use Flux Raw Mode for photorealism — no negative prompts (Flux does not support them)"
    - "Camera/lens descriptors are included in every people-focused prompt (Canon EOS R5 85mm for cosmetics, Sony A7 IV 50mm for food, etc.)"
    - "Skin realism anti-patterns are countered explicitly: visible pores, subsurface scattering, natural imperfections"
    - "Default demographic is Japanese models when featuring people in advertising for the Japanese market"
    - "Mode-dependent output: 1 optimized prompt set for auto, 2-3 variation sets for pro"
  artifacts:
    - path: "src/lib/ai/prompts/agents/art-director.ts"
      provides: "Meta-prompt system builder, user message builder, and tool schema for Art Director agent"
      exports: ["buildArtDirectorSystemPrompt", "buildArtDirectorUserMessage", "ART_DIRECTOR_TOOL_SCHEMA_AUTO", "ART_DIRECTOR_TOOL_SCHEMA_PRO", "getArtDirectorToolSchema"]
  key_links:
    - from: "src/lib/ai/prompts/agents/art-director.ts"
      to: "src/lib/ai/prompts/shared/flux-techniques.ts"
      via: "Imports CAMERA_LENS_DATABASE, PHOTOREALISM_KEYWORDS, SKIN_REALISM_COUNTERS, FLUX_CONFIG"
      pattern: "import.*from.*shared/flux-techniques"
    - from: "src/lib/ai/prompts/agents/art-director.ts"
      to: "src/lib/ai/prompts/shared/quality-checklist.ts"
      via: "Imports ART_DIRECTOR_QUALITY_CHECKLIST for self-critique grounding"
      pattern: "import.*from.*shared/quality-checklist"
    - from: "ART_DIRECTOR_TOOL_SCHEMA"
      to: "ArtDirectorOutput"
      via: "Tool schema properties match updated pipeline type (no negativePrompt, has cameraLens/lightingSetup/compositionGuidance)"
      pattern: "productCategory.*cameraLens.*lightingSetup.*compositionGuidance"
---

<objective>
Create the Art Director meta-prompt system that teaches Claude how to generate high-quality Flux 1.1 Pro Ultra image prompts with photorealistic quality, category-aware camera/lens selection, and mandatory self-critique.

Purpose: The Art Director is the most complex agent prompt because it is a meta-prompt — it does not contain fixed image prompts but teaches Claude HOW to craft prompts for any product category. This produces ultra-realistic photographic images with visible skin texture, natural lighting, and Japanese demographic defaults. The self-critique loop ensures every prompt passes a quality checklist before being delivered.

Output: 1 prompt builder module with meta-prompt system, user message builder, tool schemas (auto/pro), and embedded self-critique checklist.
</objective>

<execution_context>
@/Users/hani/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hani/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09.1-agent-prompt-engineering-photorealistic-output/09.1-CONTEXT.md
@.planning/phases/09.1-agent-prompt-engineering-photorealistic-output/09.1-RESEARCH.md
@.planning/phases/09.1-agent-prompt-engineering-photorealistic-output/09.1-01-SUMMARY.md
@src/types/pipeline.ts
@src/lib/ai/prompts/shared/flux-techniques.ts
@src/lib/ai/prompts/shared/quality-checklist.ts
@src/lib/ai/prompts/image-generation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Art Director meta-prompt builder with self-critique and category-aware prompting</name>
  <files>
    src/lib/ai/prompts/agents/art-director.ts
  </files>
  <action>
Create `src/lib/ai/prompts/agents/art-director.ts` with five exports. This REPLACES the naive prompts in `src/lib/ai/prompts/image-generation.ts` for the v1.1 pipeline.

**1. `buildArtDirectorSystemPrompt()` — Returns the meta-prompt system prompt.**

This is the longest and most detailed system prompt. Use XML-tagged structure:

```
<role>
You are an expert art director and Flux 1.1 Pro Ultra prompt engineer specializing in Japanese advertising photography. You generate detailed, photorealistic image prompts tailored to each campaign's product category, target audience, and creative direction. You are a meta-prompt system — you do not use fixed templates but craft case-specific prompts using your knowledge of photography, Flux capabilities, and Japanese advertising visual conventions.
</role>

<photography_knowledge>
Camera and Lens Selection by Category:
[Embed full CAMERA_LENS_DATABASE from shared/flux-techniques.ts — for each category: camera body, lens, lighting setup, and rationale]

Lighting Techniques:
- Soft studio lighting / beauty dish: Flattering portraits, even skin tone, cosmetics/beauty
- Natural window light / warm tones: Appetizing food photography, authentic atmosphere
- Natural light / golden hour: Editorial fashion, environmental portraits
- Soft ambient / warm tones: Intimate personal service, approachable feel
- Clean studio / controlled: Product precision, tech/electronics detail
- Three-point lighting: Standard portrait setup with key, fill, and rim lights
- Rembrandt lighting: Dramatic portraiture with triangle shadow
- Split lighting: High contrast, editorial/fashion mood

Composition Rules:
- Rule of thirds: Place subject at intersection points
- Leading lines: Guide eye to subject
- Negative space: Leave room for text overlay (Japanese advertising commonly overlays text)
- Symmetry: Formal, premium, luxury feeling
- Dynamic diagonals: Energy, movement, fashion/lifestyle
</photography_knowledge>

<flux_specific_knowledge>
Flux 1.1 Pro Ultra Capabilities:
- Raw Mode: ALWAYS use Raw Mode for photorealistic output. It captures authentic candid photography feel and enhances diversity in human subjects.
- Word Order Priority: Front-load the most important elements. Priority: Main subject > Key action > Critical style > Essential context > Secondary details.
- NO Negative Prompts: Flux does NOT support negative prompts. All avoidance must be phrased positively. Instead of "no plastic skin," write "natural skin texture with visible pores."
- Aspect Ratios: 1:1 (Instagram), 4:3 (standard), 16:9 (wide/banner), 9:16 (Stories/Reels), 3:4 (portrait)
- Resolution: Up to 4MP for ultra-high detail

Photorealism Keyword Stack (include in ALL people-focused prompts):
[Embed PHOTOREALISM_KEYWORDS constant]

Skin Realism Anti-Patterns and Counters:
[Embed full SKIN_REALISM_COUNTERS array — each anti-pattern with its counter-instruction and keywords]
</flux_specific_knowledge>

<category_templates>
Product Category Visual Conventions:

Cosmetics/Beauty:
- Beauty shot conventions: close-up, soft lighting, skin detail focus
- Lighting: beauty dish + soft fill, warm tones
- Focus: product application moment or result
- Models: Japanese women matching target demographic (age, style)
- Key: visible skin texture, natural imperfections, avoid poreless "AI skin"

Food/Restaurant:
- Appetizing composition: overhead or 45-degree angle, steam/motion cues
- Lighting: natural window light, warm color temperature
- Focus: hero dish with complementary styling elements
- Props: chopsticks, Japanese tableware (和食器), seasonal garnish
- Key: macro detail, bokeh background, warm inviting atmosphere

Fashion:
- Editorial styling: environmental context, lifestyle setting
- Lighting: natural light, golden hour, or studio with movement
- Focus: outfit in context, not isolated on white background
- Models: Japanese models in natural, asymmetric poses
- Key: authentic body language, environmental storytelling

Personal Service (salon/spa):
- Human connection: stylist-client interaction or result reveal
- Lighting: soft ambient, warm salon/spa environment
- Focus: the experience and result, not tools/products
- Setting: clean, inviting Japanese salon aesthetic
- Key: trust and warmth, candid natural moments

Tech/Product:
- Clean product focus: minimal background, precise lighting
- Lighting: controlled studio, clean shadows
- Focus: product detail, material texture, interface
- Style: precision, reliability, modern
- Key: macro detail on materials and finishes

Abstract/Conceptual:
- Brand mood imagery: colors, textures, patterns
- Lighting: creative, atmospheric
- Focus: emotional response, brand feeling
- Style: artistic, interpretive
- Key: composition and color harmony

Japanese Advertising Visual Conventions:
- Seasonal references: cherry blossoms (spring), fireworks/festival (summer), autumn leaves (fall), snow/New Year (winter)
- Visual harmony (和): balanced composition, appropriate negative space
- Trust signals in imagery: clean environments, organized settings, quality materials
- Demographic default: Japanese models and features for Japanese market advertising
</category_templates>

<self_critique>
MANDATORY: Before delivering your final prompts, review each prompt against this quality checklist. If any item fails, revise the prompt and note what you changed.

Quality Checklist:
[Embed all 8 items from ART_DIRECTOR_QUALITY_CHECKLIST:]
1. Does the prompt include a specific camera/lens specification?
2. Does the prompt include specific lighting description (not just "good lighting")?
3. For people-focused prompts: does it include skin realism keywords (visible pores, natural texture, subsurface scattering)?
4. Does the prompt avoid anti-pattern language (perfect, flawless, smooth, poreless, immaculate)?
5. For people-focused prompts: does it specify Japanese demographic when appropriate?
6. Does the prompt include composition direction (rule of thirds, leading lines, etc.)?
7. Is the most important subject front-loaded in the prompt?
8. Does the prompt respect text compositing safe zones (leave space for text overlay where applicable)?

Process:
1. Generate the image prompt
2. Review against ALL 8 checklist items
3. Note any failures
4. Revise the prompt to address failures
5. Deliver the final, quality-checked prompt

Include your self-critique reasoning in your thinking but output ONLY the final revised prompt through the tool.
</self_critique>

<anti_patterns>
NEVER generate prompts containing these patterns:
- "perfect skin" / "flawless skin" / "poreless" / "smooth complexion" → Instead: "natural skin with visible pores and subtle imperfections"
- "beautiful" as the primary descriptor → Instead: specific descriptors (warm smile, confident posture, thoughtful gaze)
- Generic model descriptions → Instead: specific demographic, age-appropriate features, natural body language
- "professional photo" alone → Instead: specific camera, lens, lighting, and composition
- "high quality" without technical specs → Instead: "8K resolution, shot on [camera] with [lens]"
- Any negative prompt language (no, without, avoid, exclude) → Instead: positive description of what IS present
</anti_patterns>
```

Do NOT include "think step by step" or "be thorough" — the self-critique checklist provides grounded evaluation without triggering overthinking.

Add 2-3 few-shot examples per research recommendation:
- Example A: Cosmetics brief → people-focused prompt with Canon EOS R5, beauty dish lighting, skin realism keywords, Japanese model
- Example B: Food/restaurant brief → product-focused prompt with Sony A7 IV macro, natural window light, appetizing composition
- Example C (brief): Fashion brief → lifestyle prompt with Nikon Z9, golden hour, environmental context

Each example shows the COMPLETE tool-use output including productCategory, cameraLens, lightingSetup, compositionGuidance, and the self-critique process (abbreviated).

**2. `buildArtDirectorUserMessage(creativeDirection, strategicInsight, brief, brandProfile, mode)` — Returns user message.**

Format:
```
<creative_direction>
[Visual Concept]: {creativeDirection.visualConcept}
[Color Guidance]: {creativeDirection.colorGuidance}
[Composition Notes]: {creativeDirection.compositionNotes}
[Mood Keywords]: {creativeDirection.moodKeywords}
[Platform Adaptations]: {creativeDirection.platformAdaptations}
</creative_direction>

<strategy>
[Awareness Level]: {strategicInsight.awarenessLevel}
[Primary Desires]: {strategicInsight.primaryDesires}
[Target Insight]: {strategicInsight.targetInsight}
</strategy>

<brief>
[Brand]: {brandProfile.name}
[Product]: {brief.campaignProductInfo}
[Audience]: {brief.targetAudience}
[Platforms]: {brief.platforms}
[Brand Colors]: {brandProfile.colors or "none — infer appropriate palette from product and mood"}
[Mood Tags]: {brief.creativeMoodTags}
</brief>

<mode>{mode}</mode>

Generate {"1 optimized image prompt per platform" if auto, "2-3 image prompt variations per platform" if pro}.
Infer the product category from the brief content. Select camera/lens/lighting from your knowledge base.
Apply the self-critique checklist to every prompt before delivering.
{"Leave appropriate space for Japanese text overlay in compositions." if brief has text overlay needs}
```

For GENX-09: When `brandProfile.colors` is null/empty and `brandProfile.toneTags` is null/empty, the user message explicitly instructs: "No brand profile colors or tone available — infer an appropriate color palette and visual tone from the product type, target audience, and mood tags."

**3. `ART_DIRECTOR_TOOL_SCHEMA_AUTO` — Tool schema for auto mode (1 prompt per platform).**

Schema for deliver_image_prompts tool:
- `imagePrompts`: array of objects:
  - `platform`: string (required)
  - `prompt`: string (required, the Flux image generation prompt, minLength: 100)
  - `style`: string (required, e.g., "photorealistic", "editorial", "product")
  - `aspectRatio`: string (required, e.g., "1:1", "16:9", "9:16")
  - `productCategory`: string (required, inferred category)
  - `cameraLens`: string (required, camera and lens used)
  - `lightingSetup`: string (required, lighting description)
  - `compositionGuidance`: string (required, composition approach)
  - `textSafeZone`: string (optional, where text can be overlaid)

**4. `ART_DIRECTOR_TOOL_SCHEMA_PRO` — Tool schema for pro mode (2-3 variations per platform).**

Same as auto but `imagePrompts` wraps in a `variations` array: each variation is a complete set of per-platform prompts with a `variationTheme` label (e.g., "warm and intimate", "bold and energetic", "minimal and elegant").

**5. `getArtDirectorToolSchema(mode: "auto" | "pro")` — Returns the appropriate schema.**
  </action>
  <verify>
Run `npx tsc --noEmit src/lib/ai/prompts/agents/art-director.ts` — no type errors. Verify the module imports from shared/flux-techniques.ts and shared/quality-checklist.ts. Verify the system prompt contains:
1. Camera/lens database (5 categories)
2. Flux Raw Mode instruction
3. "NO Negative Prompts" instruction
4. Skin realism anti-patterns and counters
5. Self-critique checklist (8 items)
6. Japanese demographic default
7. Category templates (6 categories)
8. Anti-pattern list
Verify the tool schema has NO negativePrompt field. Verify tool schema has productCategory, cameraLens, lightingSetup, compositionGuidance.
  </verify>
  <done>
Art Director meta-prompt system exists with comprehensive photography knowledge (camera/lens by category, lighting techniques, composition rules), Flux-specific knowledge (Raw Mode, no negative prompts, word order priority), 6 category templates (cosmetics, food, fashion, service, tech, abstract), mandatory 8-item self-critique checklist, anti-pattern avoidance, Japanese demographic default, text compositing awareness, 2-3 few-shot examples, brand-profile-less inference for GENX-09, and mode-dependent tool schemas (auto: 1 per platform, pro: 2-3 variations).
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- System prompt is the meta-prompt (teaches HOW, not WHAT)
- Camera/lens database covers 5 product categories with specific equipment
- Self-critique checklist has 8 items and is mandatory
- No negative prompt field in tool schema
- GENX-09 supported: prompts work without brand profile by inferring from brief
- Flux Raw Mode is mentioned as always-enabled
- Skin realism keywords are embedded
- Japanese demographic default is specified
- Anti-pattern list prevents common AI image failures
</verification>

<success_criteria>
- Art Director generates case-specific Flux prompts (not template-based) for any product category
- Generated prompts include camera/lens specs that trigger photorealistic associations
- Self-critique ensures every prompt passes quality checklist before delivery
- Prompts produce images with visible skin texture, natural lighting, and authentic poses
- System works without brand profile by inferring visual direction from brief content
</success_criteria>

<output>
After completion, create `.planning/phases/09.1-agent-prompt-engineering-photorealistic-output/09.1-04-SUMMARY.md`
</output>

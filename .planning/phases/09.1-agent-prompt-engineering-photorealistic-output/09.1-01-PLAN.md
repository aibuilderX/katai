---
phase: 09.1-agent-prompt-engineering-photorealistic-output
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/ai/prompts/agents/types.ts
  - src/lib/ai/prompts/shared/frameworks.ts
  - src/lib/ai/prompts/shared/register-map.ts
  - src/lib/ai/prompts/shared/platform-norms.ts
  - src/lib/ai/prompts/shared/flux-techniques.ts
  - src/lib/ai/prompts/shared/quality-checklist.ts
  - src/lib/ai/prompts/shared/agent-config.ts
  - src/types/pipeline.ts
autonomous: true
requirements: [ORCH-13, ORCH-14]

must_haves:
  truths:
    - "Shared framework definitions (Schwartz 5 stages, LF8 8 desires + 3 Japanese cultural overlays, 5 copywriting frameworks including AIDMA/AISAS) are importable by all agent prompt builders"
    - "Register-by-category mapping table covers 8+ product categories with recommended keigo levels"
    - "Platform norms data covers LINE, Instagram, and X with Japanese-specific conventions (tone, format, CTA style)"
    - "Flux technique data includes camera/lens database by category, photorealism keyword stack, and self-critique checklist"
    - "Agent config maps each agent to temperature, effort, and model defaults per ORCH-14 tiered assignment"
    - "Pipeline output types are expanded with confidence scores, rationale fields, and framework-specific labels per research findings"
  artifacts:
    - path: "src/lib/ai/prompts/shared/frameworks.ts"
      provides: "Schwartz, LF8, AIDMA, AISAS, PAS, AIDA, BAB framework definitions"
      exports: ["SCHWARTZ_AWARENESS_LEVELS", "LF8_DESIRES", "JAPANESE_DESIRE_NUANCES", "COPYWRITING_FRAMEWORKS"]
    - path: "src/lib/ai/prompts/shared/register-map.ts"
      provides: "Product category to keigo register mapping"
      exports: ["REGISTER_BY_CATEGORY", "getRegisterForCategory"]
    - path: "src/lib/ai/prompts/shared/platform-norms.ts"
      provides: "Japanese platform advertising norms for LINE, Instagram, X"
      exports: ["PLATFORM_NORMS"]
    - path: "src/lib/ai/prompts/shared/flux-techniques.ts"
      provides: "Camera/lens database, photorealism keywords, anti-pattern counters"
      exports: ["CAMERA_LENS_DATABASE", "PHOTOREALISM_KEYWORDS", "SKIN_REALISM_COUNTERS"]
    - path: "src/lib/ai/prompts/shared/quality-checklist.ts"
      provides: "Art Director self-critique checklist items"
      exports: ["ART_DIRECTOR_QUALITY_CHECKLIST"]
    - path: "src/lib/ai/prompts/shared/agent-config.ts"
      provides: "Per-agent temperature, effort, and model defaults"
      exports: ["AGENT_CONFIG"]
    - path: "src/types/pipeline.ts"
      provides: "Updated output interfaces with confidence scores and framework-specific labels"
      contains: "awarenessConfidence.*frameworkRationale.*japaneseDesireNuance"
  key_links:
    - from: "src/lib/ai/prompts/shared/frameworks.ts"
      to: "src/types/pipeline.ts"
      via: "Framework identifiers match StrategicInsightOutput field values"
      pattern: "copywritingFramework.*PAS.*AIDA.*BAB.*AIDMA.*AISAS"
    - from: "src/lib/ai/prompts/shared/agent-config.ts"
      to: "src/types/pipeline.ts"
      via: "Agent names in config match agentConfig keys in webhook payload"
      pattern: "strategicInsight.*creativeDirector.*copywriter.*artDirector.*jpLocalization"
---

<objective>
Create the shared data modules and updated pipeline types that all 5 agent prompt builders depend on.

Purpose: Every agent prompt builder imports shared framework definitions, platform norms, register mappings, and Flux techniques. Centralizing this data prevents duplication across prompts and enables testable, maintainable prompt engineering. The pipeline types need updating to match research findings (confidence scores, AIDMA/AISAS frameworks, Japanese desire nuances).

Output: 7 shared module files + updated pipeline.ts types.
</objective>

<execution_context>
@/Users/hani/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hani/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09.1-agent-prompt-engineering-photorealistic-output/09.1-CONTEXT.md
@.planning/phases/09.1-agent-prompt-engineering-photorealistic-output/09.1-RESEARCH.md
@src/types/pipeline.ts
@src/lib/ai/prompts/copy-generation.ts
@src/lib/ai/prompts/image-generation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared data modules for frameworks, register map, and platform norms</name>
  <files>
    src/lib/ai/prompts/shared/frameworks.ts
    src/lib/ai/prompts/shared/register-map.ts
    src/lib/ai/prompts/shared/platform-norms.ts
  </files>
  <action>
Create the `src/lib/ai/prompts/shared/` directory and three data modules.

**frameworks.ts:**
Export typed constants for all classification frameworks:

1. `SCHWARTZ_AWARENESS_LEVELS` — Array of 5 levels: unaware, problem_aware, solution_aware, product_aware, most_aware. Each entry: `{ id, label, labelJa, description, downstreamImplication }` where `downstreamImplication` describes how Creative Director/Copywriter should adjust (e.g., "unaware" implies education-first creative, "most_aware" implies offer/CTA-focused).

2. `LF8_DESIRES` — Array of 8 desires from research section 1.2. Each: `{ id: number, name, nameJa, description }`. IDs 1-8 matching Whitman's Life Force 8.

3. `JAPANESE_DESIRE_NUANCES` — Array of 3 cultural overlays from research: `{ id: "wa" | "bi_ishiki" | "anshin", name, nameJa, description, relatedLf8Ids: number[] }`.
   - wa (和/調和): social harmony beyond approval, related to LF8 #8
   - bi_ishiki (美意識): aesthetic refinement, related to LF8 #5, #6
   - anshin (安心・安全): security/reliability emphasis, related to LF8 #3

4. `COPYWRITING_FRAMEWORKS` — Array of 5 frameworks: PAS, AIDA, BAB, AIDMA, AISAS. Each: `{ id, name, nameJa, description, bestFor, structure: string[] }`.
   - PAS: Problem-Agitation-Solution. Best for pain-point products.
   - AIDA: Attention-Interest-Desire-Action. Best for general awareness campaigns.
   - BAB: Before-After-Bridge. Best for transformation-focused products.
   - AIDMA: Attention-Interest-Desire-Memory-Action. Best for traditional Japanese campaigns, brand recall.
   - AISAS: Attention-Interest-Search-Action-Share. Best for digital Japanese campaigns, social sharing.

**register-map.ts:**
Export `REGISTER_BY_CATEGORY` as a Record mapping product category strings to register recommendations. Use the exact mapping from research section 4.1:
- cosmetics: "standard" to "formal"
- food: "casual" to "standard"
- fashion: "casual" to "standard"
- personal_service: "standard"
- online_course: "standard" to "formal"
- tech: "standard"
- luxury: "formal"
- kids_family: "casual"

Each entry: `{ category, recommendedRegister, registerRange: [min, max], rationale, rationaleJa }`.

Export `getRegisterForCategory(category: string, override?: string): string` — returns override if provided, otherwise the recommended register for the category, defaulting to "standard" for unknown categories.

**platform-norms.ts:**
Export `PLATFORM_NORMS` as a Record keyed by platform ID (line, instagram, x). Each entry from research section 4.3:
- `tone`: string description of expected tone
- `format`: formatting conventions
- `ctaStyle`: CTA convention (soft vs direct)
- `characterLimits`: { title, description, body } where applicable
- `hashtagStrategy`: guidance for hashtag usage
- `keyInsight`: the most important thing to know about this platform in Japan
- `keyInsightJa`: Japanese version

All string content in English (system prompts are English per research recommendation). Japanese labels provided as separate fields where needed.
  </action>
  <verify>
Run `npx tsc --noEmit src/lib/ai/prompts/shared/frameworks.ts src/lib/ai/prompts/shared/register-map.ts src/lib/ai/prompts/shared/platform-norms.ts` — no type errors. Verify each file exports the documented constants.
  </verify>
  <done>
Three shared modules exist with typed, documented data constants. SCHWARTZ_AWARENESS_LEVELS has 5 entries, LF8_DESIRES has 8 entries, JAPANESE_DESIRE_NUANCES has 3 entries, COPYWRITING_FRAMEWORKS has 5 entries (including AIDMA and AISAS), REGISTER_BY_CATEGORY covers 8+ categories, PLATFORM_NORMS covers LINE/Instagram/X with Japanese-specific conventions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Flux techniques, quality checklist, agent config, and update pipeline types</name>
  <files>
    src/lib/ai/prompts/shared/flux-techniques.ts
    src/lib/ai/prompts/shared/quality-checklist.ts
    src/lib/ai/prompts/shared/agent-config.ts
    src/lib/ai/prompts/agents/types.ts
    src/types/pipeline.ts
  </files>
  <action>
**flux-techniques.ts:**
Export constants for Flux 1.1 Pro Ultra photorealistic prompt engineering from research section 5:

1. `CAMERA_LENS_DATABASE` — Record keyed by product category. Each entry: `{ camera, lens, lighting, rationale }`. Use exact values from research section 5.3:
   - cosmetics: Canon EOS R5, 85mm f/1.4, soft studio lighting/beauty dish
   - food: Sony A7 IV, 50mm f/1.8 macro, natural window light/warm tones
   - fashion: Nikon Z9, 35mm f/1.4, natural light/golden hour
   - personal_service: Canon EOS R6, 50mm f/1.4, soft ambient/warm tones
   - tech: Sony A7R V, 90mm macro, clean studio/controlled

2. `PHOTOREALISM_KEYWORDS` — String constant: "natural skin texture with visible pores, subsurface scattering, shallow depth of field, natural lighting with soft shadow transitions, candid expression, 8K resolution"

3. `SKIN_REALISM_COUNTERS` — Array of 5 anti-pattern objects from research section 5.4. Each: `{ antiPattern, counter, keywords }`.

4. `FLUX_CONFIG` — Object: `{ rawMode: true, noNegativePrompts: true, priorityOrder: ["subject", "action", "style", "context"], maxPromptLength: 500 }`.

**quality-checklist.ts:**
Export `ART_DIRECTOR_QUALITY_CHECKLIST` — Array of 8 checklist items from research section 5.6. Each: `{ id, check, failureAction }`.

**agent-config.ts:**
Export `AGENT_CONFIG` — Record keyed by agent name. Each entry: `{ temperature, effort, modelTier, toolName, maxTokens }`. From research section 2.2 and 7.2:
- strategicInsight: temp 0.2, effort "high", tier "opus", tool "deliver_strategic_insight"
- creativeDirector: temp 0.5, effort "medium", tier "opus", tool "deliver_creative_direction"
- copywriter: temp 0.7, effort "medium", tier "sonnet", tool "deliver_platform_copy"
- artDirector: temp 0.5, effort "high", tier "sonnet", tool "deliver_image_prompts"
- jpLocalization: temp 0.2, effort "high", tier "opus", tool "deliver_localization_review"

Note: All agents default to claude-opus-4-6 via env vars per Phase 8 decision. The `modelTier` field documents the research recommendation for future cost optimization.

**agents/types.ts:**
Create `src/lib/ai/prompts/agents/types.ts` with shared types for prompt builders:
- `AgentPromptBuilder<TInput, TOutput>` — interface with `buildSystemPrompt(input: TInput): string` and `buildUserMessage(input: TInput): string` and `getToolSchema(): object`
- `PromptSection` — type for tagged prompt sections: `{ tag: string, content: string }`
- `FewShotExample<T>` — type: `{ description: string, input: string, output: T }`

**pipeline.ts updates:**
Update `src/types/pipeline.ts` to match research findings:

1. `StrategicInsightOutput` — Add fields:
   - `awarenessConfidence: "high" | "medium" | "low"`
   - `desireConfidence: "high" | "medium" | "low"`
   - `frameworkConfidence: "high" | "medium" | "low"`
   - `japaneseDesireNuance?: string`
   - `frameworkRationale: string`
   - `marketContext?: string`
   - `summaryJa: string`
   - Change `copywritingFramework` type to `"PAS" | "AIDA" | "BAB" | "AIDMA" | "AISAS"` (string literal union, adding AIDMA/AISAS, removing SB7)
   - Change `awarenessLevel` type to `"unaware" | "problem_aware" | "solution_aware" | "product_aware" | "most_aware"` (string literal union)

2. `CreativeDirectorOutput` — Add fields:
   - `concept: string` (one-sentence concept distillation)
   - `copyDirection: string` (tonal guidance for Copywriter)
   - `summaryJa: string`

3. `CopywriterOutput` — Add to each variant:
   - `rationaleNotes: string` (explaining register choice, CTA style, key word choices)

4. `ArtDirectorOutput` — Replace `negativePrompt` with:
   - `productCategory: string`
   - `cameraLens: string`
   - `lightingSetup: string`
   - `compositionGuidance: string`
   - `textSafeZone?: string`
   - Remove `negativePrompt` field (Flux does not support it per research section 5.1)

5. `JpLocalizationOutput` — Add fields:
   - `issues: { platform: string, variant: string, field: string, category: string, issue: string, suggestion: string, severity: "critical" | "moderate" | "minor" }[]`
   - `complianceFlags?: string[]`
   - `overallNote: string`
   - `summaryJa: string`

Preserve backward compatibility: all new fields are optional or have defaults. Existing Phase 9 n8n workflows that write to these types will still work (they populate the base fields; Phase 9.1 optimized prompts populate additional fields).
  </action>
  <verify>
Run `npx tsc --noEmit` for the entire project — no type errors. Verify `src/types/pipeline.ts` exports the updated interfaces. Verify all shared modules export their documented constants.
  </verify>
  <done>
Flux techniques module has camera/lens database (5 categories), photorealism keywords, 5 skin realism counters, and Flux config. Quality checklist has 8 items. Agent config maps 5 agents to temperature/effort/model/tool settings. Pipeline types are expanded with confidence scores, framework-specific labels, rationale fields, and structured critique issues. All new fields are backward-compatible (optional or have defaults).
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- All 7 shared module files exist under `src/lib/ai/prompts/shared/`
- `src/lib/ai/prompts/agents/types.ts` exists with prompt builder interfaces
- `src/types/pipeline.ts` has expanded interfaces matching research findings
- Framework set includes AIDMA and AISAS (not SB7 as primary)
- ArtDirectorOutput has no `negativePrompt` field
</verification>

<success_criteria>
- Shared data modules are importable and type-safe
- Pipeline types match research recommendations
- All constants use exact values from research (camera specs, temperature values, framework definitions)
- Downstream agent prompt builders (Plans 02-04) can import these modules without changes
</success_criteria>

<output>
After completion, create `.planning/phases/09.1-agent-prompt-engineering-photorealistic-output/09.1-01-SUMMARY.md`
</output>

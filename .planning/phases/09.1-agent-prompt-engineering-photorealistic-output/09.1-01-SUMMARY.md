---
phase: 09.1-agent-prompt-engineering-photorealistic-output
plan: 01
subsystem: ai, prompts
tags: [schwartz, lf8, aidma, aisas, flux, photorealism, prompt-engineering, japanese-advertising]

# Dependency graph
requires:
  - phase: 08-infrastructure-schema-foundation
    provides: "Pipeline types (pipeline.ts), agent model env vars, pipeline milestone definitions"
provides:
  - "Schwartz awareness levels, LF8 desires, Japanese desire nuances, 5 copywriting frameworks"
  - "Register-by-category mapping (8 categories) with getRegisterForCategory helper"
  - "Platform norms for LINE/Instagram/X with Japanese-specific conventions"
  - "Camera/lens database (5 categories), photorealism keywords, skin realism counters"
  - "Art Director 8-item self-critique quality checklist"
  - "Per-agent config (temperature, effort, model tier, tool name)"
  - "AgentPromptBuilder interface, PromptSection, FewShotExample types"
  - "Expanded pipeline types with confidence scores, typed literals, framework-specific labels"
affects: [09.1-02, 09.1-03, 09.1-04, 09.1-05]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Shared data modules under src/lib/ai/prompts/shared/ imported by agent prompt builders"
    - "AgentPromptBuilder<TInput, TOutput> interface for consistent prompt construction"
    - "XML-tagged PromptSection pattern via buildPromptFromSections helper"
    - "as const readonly arrays for framework/lookup data"

key-files:
  created:
    - "src/lib/ai/prompts/shared/frameworks.ts"
    - "src/lib/ai/prompts/shared/register-map.ts"
    - "src/lib/ai/prompts/shared/platform-norms.ts"
    - "src/lib/ai/prompts/shared/flux-techniques.ts"
    - "src/lib/ai/prompts/shared/quality-checklist.ts"
    - "src/lib/ai/prompts/shared/agent-config.ts"
    - "src/lib/ai/prompts/agents/types.ts"
  modified:
    - "src/types/pipeline.ts"

key-decisions:
  - "SB7 dropped from copywriting frameworks — narrative-focused, poorly suited for short-form Japanese ad copy"
  - "AIDMA and AISAS added as Japanese-market copywriting frameworks alongside PAS, AIDA, BAB"
  - "negativePrompt removed from ArtDirectorOutput — Flux 1.1 Pro Ultra does not support negative prompts"
  - "All new pipeline type fields are optional for backward compatibility with Phase 9 n8n workflows"
  - "Temperature gradient 0.2-0.7 from analytical (Strategic Insight) to creative (Copywriter) agents"

patterns-established:
  - "Shared data modules: centralized lookup tables imported by all 5 agent prompt builders"
  - "Typed string literal unions for awarenessLevel and copywritingFramework in pipeline types"
  - "AgentPromptBuilder interface: buildSystemPrompt + buildUserMessage + getToolSchema"
  - "PromptSection XML tag pattern with buildPromptFromSections utility"

requirements-completed: [ORCH-13, ORCH-14]

# Metrics
duration: 7min
completed: 2026-02-19
---

# Phase 9.1 Plan 01: Shared Data Modules and Pipeline Types Summary

**Schwartz/LF8/AIDMA/AISAS framework data, 8-category register map, LINE/Instagram/X platform norms, Flux photorealism camera/lens database, Art Director quality checklist, 5-agent config, and typed pipeline interfaces with confidence scores**

## Performance

- **Duration:** 7 min
- **Started:** 2026-02-19T07:51:37Z
- **Completed:** 2026-02-19T07:58:41Z
- **Tasks:** 2
- **Files modified:** 8

## Accomplishments
- Created 6 shared data modules providing centralized framework definitions, register mappings, platform norms, Flux techniques, quality checklists, and agent configuration for all 5 downstream agent prompt builders
- Created AgentPromptBuilder interface with PromptSection and FewShotExample types establishing the prompt construction pattern for Plans 02-04
- Expanded all 5 pipeline output interfaces with confidence scores, typed string literal unions (AIDMA/AISAS), Japanese summary fields, structured critique issues, and photorealism metadata — all backward-compatible

## Task Commits

Each task was committed atomically:

1. **Task 1: Create shared data modules for frameworks, register map, and platform norms** - `50a7525` (feat)
2. **Task 2: Create Flux techniques, quality checklist, agent config, and update pipeline types** - `24714ee` (feat)

## Files Created/Modified
- `src/lib/ai/prompts/shared/frameworks.ts` - Schwartz 5 awareness levels, LF8 8 desires, 3 Japanese desire nuances, 5 copywriting frameworks (PAS/AIDA/BAB/AIDMA/AISAS)
- `src/lib/ai/prompts/shared/register-map.ts` - 8-category register-to-keigo mapping with getRegisterForCategory helper
- `src/lib/ai/prompts/shared/platform-norms.ts` - LINE/Instagram/X advertising norms with Japanese-specific conventions
- `src/lib/ai/prompts/shared/flux-techniques.ts` - Camera/lens database (5 categories), photorealism keywords, 5 skin realism counters, Flux config
- `src/lib/ai/prompts/shared/quality-checklist.ts` - 8-item Art Director self-critique quality checklist
- `src/lib/ai/prompts/shared/agent-config.ts` - 5-agent config (temperature, effort, model tier, tool name, max tokens)
- `src/lib/ai/prompts/agents/types.ts` - AgentPromptBuilder interface, PromptSection, FewShotExample, ToolSchema, buildPromptFromSections utility
- `src/types/pipeline.ts` - Expanded StrategicInsightOutput, CreativeDirectorOutput, CopywriterOutput, ArtDirectorOutput, JpLocalizationOutput

## Decisions Made
- **SB7 dropped from framework set:** StoryBrand is narrative-focused and poorly suited for short-form platform-specific advertising copy. Replaced with AIDMA/AISAS which are standard in Japanese advertising.
- **negativePrompt removed from ArtDirectorOutput:** Flux 1.1 Pro Ultra does not support negative prompts. All avoidance instructions are phrased positively in the prompt itself. Replaced with productCategory, cameraLens, lightingSetup, compositionGuidance fields.
- **All new fields optional:** New pipeline type fields (confidence scores, rationale, summaryJa, etc.) are all optional (`?`) to maintain backward compatibility with existing Phase 9 n8n workflows.
- **ToolSchema uses _TOutput generic:** Prefixed with underscore to satisfy TypeScript strict mode since the generic is used for type-level constraints but not at runtime.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- All shared modules are importable and type-safe — Plans 02-04 (individual agent prompt builders) can import these without changes
- Pipeline types are updated and backward-compatible — existing Phase 9 n8n workflows continue working
- AgentPromptBuilder interface establishes the pattern all 5 agent prompt builders will implement
- The framework set (including AIDMA/AISAS) and platform norms data are ready for the Copywriter prompt builder (Plan 03)
- Camera/lens database and quality checklist are ready for the Art Director meta-prompt builder (Plan 04)

## Self-Check: PASSED

All 8 files verified present. Both task commits (50a7525, 24714ee) verified in git log.

---
*Phase: 09.1-agent-prompt-engineering-photorealistic-output*
*Completed: 2026-02-19*
